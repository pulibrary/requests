# PUL Requests Engine

[![CircleCI](https://circleci.com/gh/pulibrary/requests.svg?style=svg)](https://circleci.com/gh/pulibrary/requests)

## Dependencies

The engine requires a working copy of marc_liberation aka bibdata to be running. Defaults to https://bibdata.princeton.edu. If you wish to override that value while doing development work and point a local working copy you can set your local environment variable of ```BIBDATA_BASE``` to the root of the marc_liberation application you want to work with.

The gem also is dependent on Orangelight to service requests for non-voyager IDs. By default it utilizes the production Orangelight system at https://pulsearch.princeton.edu/.

### Chromedriver for Feature tests

You need to have a working version of Chromedriver http://chromedriver.chromium.org/ on your path to successfully run the feature tests associated with this project. Homebrew is a good way to accomplish this. It is currently part of https://github.com/Homebrew/homebrew-cask. 

## To Install for Development

After you've cloned the repo:

```
$ bundle install
$ bundle exec rake ci
```

With Code Coverage Report
```
$ COVERAGE=true bundle exec rake ci
```

## Working within Orangelight locally
This engine is mouting within Orangelight. To test your local engine code interactively update the OL gemfile reference to the gemfile:

Change:
```
gem 'requests', git: 'git@github.com:pulibrary/requests.git', branch: 'development'
```

to:
```
gem 'requests', path: '/mylocal/path/to/the/gem/requests'
```

and run ```bundle update requests``` to point your local copy of OL at your local requests gem.


## Install in Production

* Add ```gem 'requests', :git 'git@github.com:pulibrary/requests.git'```
* ```bundle install```
* ```rails generate requests:install```

This project rocks and uses MIT-LICENSE.

## Basic Usage

### Routes
* When installed a request form can be generated by passing a record identifier within the following route using one of three ID schemes currently available in Orangelight:

1. ```/requests/{voyager_id}``` Example: https://pulsearch.princeton.edu/requests/9702169
  a. Optional Params
    1. ```mfhd``` https://pulsearch.princeton.edu/requests/9702169?mfhd=9525518 - Ask for a specifif holding recoord
    2. ```source``` https://pulsearch.princeton.edu/requests/9702169?mfhd=9525518&source=pulsearch - Facilitates redirection to the source system that generated the request. Currently responds to ```pulsearch``` or ```catalog```, other values will be ignored.
2. ```/requests/{thesis_id}``` Example: https://pulsearch.princeton.edu/requests/dsp01vx021h212. This will result in a redirect to the AEON system.
